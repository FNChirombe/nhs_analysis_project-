# Technical Documentation: NHS Performance Analysis

**Author:** [Fungai Nicole Chirombe/Data Analytics Department]
**Version:** 1.0
**Date:** June 22, 2025

## 1. Project Overview
This document outlines the technical methodology for the NHS Performance Analysis project. The project's goal is to process, analyze, and visualize summary-level NHS data to derive actionable insights for hospital management. The project consists of a Python-based ETL pipeline, a SQLite database for data storage, and a data export for visualization in Tableau.

## 2. Data Sources
The project utilizes the "NHS Free Dataset for Analysis" available on Kaggle, authored by Ahad Saleem. The following files were used:
- `AE_Activity.xlsx`: Contains yearly summary data of A&E attendances.
- `AE_Quality_Index.xlsx`: Contains monthly quality metrics for A&E departments by organization.
- `Consultation.csv`: Contains monthly summary data of outpatient and consultant-led activity.

## 3. ETL (Extract, Transform, Load) Pipeline
The core of the project is the `etl_pipeline.py` script, which performs the following steps:

### 3.1. Extract
- The script connects to the `/kaggle/input/` directory.
- It uses a configuration dictionary (`file_config`) to specify the exact sheet name and header row for each Excel file, ensuring the correct data table is extracted.
- Error handling is in place to log issues if source files are not found.

### 3.2. Transform
- **A&E Activity Data:** The script reads the `ae_attendances` sheet. It transforms the "wide" data format (with years as columns) into a "long" format using `pandas.melt`. This makes the data suitable for time-series analysis.
- **A&E Quality Data:** The script reads the `AE_Quality_Index` sheet. It uses `pandas.pivot_table` to reshape the data, transforming the `MEASURE_NAME` rows into distinct columns. This is a critical step to align different metrics (e.g., waiting time, satisfaction) for the same organization and month.
- **Merging:** The transformed quality and attendance data are merged into a single, comprehensive DataFrame using `pandas.merge_asof`. This function is specifically chosen to map the yearly attendance figure to each month within that year, providing context for the monthly quality metrics.

### 3.3. Load
- **SQLite Database:** The final, transformed DataFrame is loaded into a SQLite database file (`nhs_data.db`) located in `/kaggle/working/`. The data is stored in a table named `quality_and_attendance`. The `if_exists='replace'` parameter ensures the pipeline is idempotent (i.e., it can be re-run without creating duplicate data).
- **Tableau CSV:** The same final DataFrame is saved as `tableau_data.csv` in `/kaggle/working/`. This file is optimized for direct use in Tableau Public.

## 4. Database Schema
The SQLite database contains a single table: `quality_and_attendance`. The schema is dynamically generated by pandas based on the final DataFrame and includes columns such as:
- `ORG_CODE` (TEXT)
- `ORG_NAME` (TEXT)
- `Month` (TIMESTAMP)
- `PATIENT_SATISFACTION_SCORE` (REAL)
- `TOTAL_TIME_MEDIAN_ADMITTED` (REAL)
- `Year` (TEXT)
- `Total Attendances` (INTEGER)
- ...and other quality metrics.

## 5. Key Assumptions
- **Financial Year:** The A&E attendance data is provided by financial year (e.g., '2022-23'). For merging purposes, this is mapped to a start date of April 1st (e.g., '2022-04-01').
- **Data Granularity:** The analysis assumes that the national-level summary data is representative of general trends. The insights are strategic and directional; they are not a substitute for local, trust-level analysis.
- **Data Completeness:** The `pivot_table` and merge operations rely on data being present for the metrics being analyzed. The final table contains only records where a full set of data was available.